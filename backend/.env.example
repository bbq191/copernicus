# LLM Configuration (Ollama native API)
LLM_BASE_URL=http://localhost:11434
LLM_MODEL_NAME=qwen3:latest
LLM_TEMPERATURE=0.1
LLM_TIMEOUT=120                                                         # 单次请求超时（秒），超时后使用原文 fallback
OLLAMA_NUM_CTX=32768
OLLAMA_NUM_CTX_CORRECTION=16384

# ASR 模式: paraformer (说话人分离) | sensevoice (抗噪增强)
ASR_MODE=paraformer

# Paraformer 模型配置 (ASR_MODE=paraformer 时使用)
# 使用分离模型组合，VAD 可以控制切分参数防止 OOM
ASR_MODEL_DIR=iic/speech_seaco_paraformer_large_asr_nat-zh-cn-16k-common-vocab8404-pytorch
VAD_MODEL_DIR=iic/speech_fsmn_vad_zh-cn-16k-common-pytorch
PUNC_MODEL_DIR=iic/punc_ct-transformer_zh-cn-common-vocab272727-pytorch
SPK_MODEL_DIR=iic/speech_campplus_sv_zh-cn_16k-common

# SenseVoice 模型配置 (ASR_MODE=sensevoice 时使用)
# SenseVoice 需配合 VAD 使用，系统会自动将长音频切分为 15 秒片段
# 支持 Emoji 和特殊标记自动清洗
SENSEVOICE_MODEL_DIR=iic/SenseVoiceSmall
SENSEVOICE_LANGUAGE=zh                                                   # auto | zh | en | yue | ja | ko
SENSEVOICE_MAX_SEGMENT_MS=15000                                          # 单段最大时长，超过则后处理分割

# 说话人分离配置 (基于声纹相似度聚类)
# 使用滑动窗口提取多个声纹 embedding，然后基于余弦距离聚类
SPK_SLIDING_WINDOW_MS=1500                                               # 声纹提取窗口大小
SPK_SLIDING_STEP_MS=750                                                  # 窗口滑动步长（50% 重叠）
SPK_SLIDING_THRESHOLD_MS=3000                                            # 超过此时长启用滑动窗口
SPK_DISTANCE_THRESHOLD=0.5                                               # 余弦距离阈值（0-1，越小越严格）

# 噪声过滤
FILTER_NOISE_SEGMENTS=true                                               # 过滤仅含语气词的纯噪声段落

# ASR 通用配置
# 重要：确保安装了 CUDA 版 PyTorch，否则会回退到 CPU
# pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
ASR_DEVICE=auto                                                          # auto | cuda | cpu
ASR_BATCH_SIZE=60                                                        # 说话人分离时自动限制为 60 秒以避免 OOM
ASR_DTYPE=float16                                                        # float32 | float16 | bfloat16
ASR_DISABLE_PBAR=true                                                    # 关闭推理进度条

# 音频增强 (ffmpeg loudnorm + 降噪)
AUDIO_ENHANCE=true                                                       # 解决说话人远近不一、背景嘈杂问题

# Correction Settings
# 每批次字符数上限，减小可加速单批处理（推荐 150-300）
# 批次越小，thinking 推理时间越短，但批次数量越多
CORRECTION_CHUNK_SIZE=200
CORRECTION_OVERLAP=50
CORRECTION_MAX_CONCURRENCY=3                                             # LLM 并发数
PRE_MERGE_GAP_MS=1000
# Evaluation (Map-Reduce 分段摘要)
# 长文本自动切分为多段分别提取要点，再合并生成最终评估
EVALUATION_MAX_TEXT_CHARS=50000                                              # 总上限，超过则截断
EVALUATION_CHUNK_SIZE=6000                                                  # Map 分段大小，短于此直接评估
EVALUATION_NUM_CTX=8192                                                     # 评估专用 num_ctx，控制显存

# pycorrector 轻量级纠错（阶段 2）
# 使用 MacBERT 模型处理常见错别字，减轻 LLM 负担
PYCORRECTOR_ENABLED=true                                                 # 是否启用阶段 2
PYCORRECTOR_MODEL=macbert                                                # macbert | kenlm

# HuggingFace 离线模式（可选，避免每次启动联网检查）
# HF_HUB_OFFLINE=1                                                       # 启用后完全离线，需先下载模型

# Hotwords (optional, path to a text file with one hotword per line)
# HOTWORDS_FILE=./hotwords.txt

# Upload Settings
UPLOAD_DIR=./uploads
MAX_UPLOAD_SIZE_MB=15000
